 /**
 * Generated by afx
 * dont edit by hande
 */
#include "azer/samples/vertex_buffer/share_texcoord/indepeffect.afx.h"

#include <stddef.h>

#include "base/basictypes.h"
#include "base/logging.h"

#include "azer/render/render.h"
#include "azer/render/util.h"

const char IndepDiffuseEffect::kEffectName[] = "diffuse";
const azer::VertexDesc::Desc IndepDiffuseEffect::kVertexDesc[] = {
  {"POSITION", 0, azer::kVec4, 0, 0, false},
  {"TEXCOORD", 0, azer::kVec2, 0, 0, false},
};

const int IndepDiffuseEffect::kVertexDescNum = arraysize(IndepDiffuseEffect::kVertexDesc);

IndepDiffuseEffect::IndepDiffuseEffect() 
  : azer::Effect(azer::RenderSystem::Current()) {
}

IndepDiffuseEffect::~IndepDiffuseEffect() {
}

const char* IndepDiffuseEffect::GetEffectName() const {
   return kEffectName;
}
bool IndepDiffuseEffect::Init(const ShaderPrograms& sources) {
  DCHECK(sources.size() == azer::kRenderPipelineStageNum);
  DCHECK(!sources[azer::kVertexStage].code.empty());
  DCHECK(!sources[azer::kPixelStage].code.empty());
  InitTechnique(sources);
  InitGpuConstantTable();
  return true;
}

void IndepDiffuseEffect::InitGpuConstantTable() {
  // generate GpuTable init for stage azer::kVertexStage
  azer::GpuConstantsTable::Desc vs_table_desc[] = {
    azer::GpuConstantsTable::Desc("pvw", azer::GpuConstantsType::kMatrix4,
         offsetof(vs_cbuffer, pvw), 1),
  };
  gpu_table_[azer::kVertexStage] = render_system_->CreateGpuConstantsTable(
      arraysize(vs_table_desc), vs_table_desc);
}
void IndepDiffuseEffect::InitTechnique(const ShaderPrograms& sources) {
  vertex_desc_ptr_ = new azer::VertexDesc(kVertexDesc, kVertexDescNum);
  InitShaders(sources);
}

void IndepDiffuseEffect::UseTexture(azer::Renderer* renderer) {
  renderer->UseTexture(azer::kPixelStage, 0, tex_.get());
}

void IndepDiffuseEffect::ApplyGpuConstantTable(azer::Renderer* renderer) {
}

#define SHADER_PATH "azer/samples/vertex_buffer/share_texcoord/diffuse.afx"
IndepDiffuseEffectPtr CreateDiffuse() {
  azer::Effect::ShaderPrograms shaders;
  CHECK(azer::LoadShaderAtStage(azer::kVertexStage, SHADER_PATH ".vs", &shaders));
  CHECK(azer::LoadShaderAtStage(azer::kPixelStage, SHADER_PATH ".ps", &shaders));
  IndepDiffuseEffectPtr effect(new IndepDiffuseEffect());
  effect->Init(shaders);
  return effect;
}
